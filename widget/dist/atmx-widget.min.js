"use strict";(()=>{(function(){"use strict";let g="#atmx-weather-protection, [data-atmx-widget]",n={shield:'<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',check:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',alert:'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'},p=`
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :host {
      display: block;
      --atmx-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --atmx-mono: "SF Mono", "Fira Code", Consolas, Monaco, monospace;
    }

    /* \u2500\u2500 Light Theme (default) \u2500\u2500 */
    .atmx {
      font-family: var(--atmx-font);
      font-size: 14px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      --bg: #ffffff;
      --surface: #f7f8fa;
      --border: #e5e7eb;
      --border-hover: #d1d5db;
      --text: #111827;
      --text-2: #6b7280;
      --text-3: #9ca3af;
      --accent: #4f7fff;
      --accent-bg: rgba(79, 127, 255, 0.06);
      --green: #16a34a;
      --green-bg: rgba(22, 163, 74, 0.06);
      --green-border: rgba(22, 163, 74, 0.15);
      --amber: #d97706;
      --amber-bg: rgba(217, 119, 6, 0.06);
      --amber-border: rgba(217, 119, 6, 0.15);
      --red: #dc2626;
      --red-bg: rgba(220, 38, 38, 0.04);
      --red-border: rgba(220, 38, 38, 0.12);
      --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 2px 16px rgba(0,0,0,0.04);
      --shadow-active: 0 0 0 1px rgba(22,163,74,0.15), 0 2px 16px rgba(22,163,74,0.06);
      --radius: 12px;
      --radius-sm: 8px;
      --radius-xs: 6px;
      --transition: 200ms ease;
    }

    /* \u2500\u2500 Dark Theme \u2500\u2500 */
    .atmx--dark {
      --bg: #14141f;
      --surface: #1c1c2b;
      --border: #2a2a3e;
      --border-hover: #363650;
      --text: #ededf0;
      --text-2: #9494aa;
      --text-3: #606078;
      --accent: #4f7fff;
      --accent-bg: rgba(79, 127, 255, 0.1);
      --green: #22c55e;
      --green-bg: rgba(34, 197, 94, 0.08);
      --green-border: rgba(34, 197, 94, 0.2);
      --amber: #f59e0b;
      --amber-bg: rgba(245, 158, 11, 0.08);
      --amber-border: rgba(245, 158, 11, 0.2);
      --red: #ef4444;
      --red-bg: rgba(239, 68, 68, 0.06);
      --red-border: rgba(239, 68, 68, 0.15);
      --shadow: 0 2px 8px rgba(0,0,0,0.25), 0 4px 24px rgba(0,0,0,0.15);
      --shadow-active: 0 0 0 1px rgba(34,197,94,0.2), 0 4px 24px rgba(34,197,94,0.06);
    }

    /* \u2500\u2500 Card \u2500\u2500 */
    .atmx-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: border-color var(--transition), box-shadow var(--transition);
    }
    .atmx-card--active {
      border-color: var(--green-border);
      box-shadow: var(--shadow-active);
    }

    /* \u2500\u2500 Header \u2500\u2500 */
    .atmx-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
    }
    .atmx-header__left {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--accent);
    }
    .atmx-header__title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      letter-spacing: -0.01em;
    }
    .atmx-header__brand {
      font-size: 10px;
      font-weight: 700;
      color: var(--text-3);
      letter-spacing: 0.08em;
    }

    /* \u2500\u2500 Body \u2500\u2500 */
    .atmx-body {
      padding: 16px 20px;
    }

    /* \u2500\u2500 Risk Assessment \u2500\u2500 */
    .atmx-risk { margin-bottom: 14px; }
    .atmx-risk__row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .atmx-risk__emoji { font-size: 18px; line-height: 1; }
    .atmx-risk__text { font-size: 13px; font-weight: 500; color: var(--text); }
    .atmx-risk__pct { font-weight: 700; }

    .atmx-risk__bar {
      height: 6px;
      background: var(--surface);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .atmx-risk__fill {
      height: 100%;
      border-radius: 3px;
      width: 0%;
      transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
    }
    .atmx-risk__fill--low { background: var(--green); }
    .atmx-risk__fill--moderate { background: var(--amber); }
    .atmx-risk__fill--high { background: var(--red); }

    .atmx-risk__badge {
      display: inline-flex;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 9px;
      border-radius: 100px;
    }
    .atmx-risk__badge--low {
      background: var(--green-bg);
      color: var(--green);
      border: 1px solid var(--green-border);
    }
    .atmx-risk__badge--moderate {
      background: var(--amber-bg);
      color: var(--amber);
      border: 1px solid var(--amber-border);
    }
    .atmx-risk__badge--high {
      background: var(--red-bg);
      color: var(--red);
      border: 1px solid var(--red-border);
    }

    /* \u2500\u2500 Divider \u2500\u2500 */
    .atmx-divider {
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }

    /* \u2500\u2500 Detail Rows \u2500\u2500 */
    .atmx-details {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .atmx-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
    }
    .atmx-row__label { color: var(--text-2); }
    .atmx-row__value {
      font-weight: 500;
      color: var(--text);
      text-align: right;
    }
    .atmx-row__value--green {
      color: var(--green);
      font-weight: 600;
    }

    /* \u2500\u2500 Toggle Area \u2500\u2500 */
    .atmx-toggle-area {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 14px;
      background: var(--surface);
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      margin-top: 14px;
      cursor: pointer;
      transition: all var(--transition);
      user-select: none;
      -webkit-user-select: none;
    }
    .atmx-toggle-area:hover {
      border-color: var(--border-hover);
    }
    .atmx-toggle-area:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    .atmx-toggle-area--on {
      background: var(--green-bg);
      border-color: var(--green-border);
    }
    .atmx-toggle-area--on:hover {
      border-color: var(--green-border);
    }
    .atmx-toggle-area__left {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }
    .atmx-toggle-area__icon {
      font-size: 15px;
      line-height: 1;
      flex-shrink: 0;
    }
    .atmx-toggle-area__text {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      white-space: nowrap;
    }
    .atmx-toggle-area__price {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-2);
      margin-left: auto;
      flex-shrink: 0;
    }

    /* \u2500\u2500 Toggle Switch \u2500\u2500 */
    .atmx-switch {
      position: relative;
      width: 44px;
      height: 24px;
      border-radius: 12px;
      background: var(--border);
      border: none;
      cursor: pointer;
      flex-shrink: 0;
      transition: background var(--transition);
      padding: 0;
      -webkit-appearance: none;
      appearance: none;
    }
    .atmx-switch:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    .atmx-switch--on { background: var(--accent); }
    .atmx-switch__knob {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
      transition: transform var(--transition);
      pointer-events: none;
    }
    .atmx-switch--on .atmx-switch__knob {
      transform: translateX(20px);
    }

    /* \u2500\u2500 Footer \u2500\u2500 */
    .atmx-footer {
      padding: 8px 20px;
      border-top: 1px solid var(--border);
      text-align: center;
    }
    .atmx-footer__text {
      font-size: 11px;
      color: var(--text-3);
    }
    .atmx-footer__link {
      color: var(--text-2);
      text-decoration: none;
      font-weight: 600;
      transition: color var(--transition);
    }
    .atmx-footer__link:hover { color: var(--accent); }

    /* \u2500\u2500 Success Banner \u2500\u2500 */
    .atmx-success {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: var(--green-bg);
      border: 1px solid var(--green-border);
      border-radius: var(--radius-sm);
      margin-bottom: 14px;
      animation: atmx-in 0.3s ease;
    }
    .atmx-success__icon {
      color: var(--green);
      flex-shrink: 0;
      line-height: 0;
    }
    .atmx-success__text {
      font-size: 13px;
      font-weight: 600;
      color: var(--green);
    }

    /* \u2500\u2500 Error Banner \u2500\u2500 */
    .atmx-error-msg {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      background: var(--red-bg);
      border: 1px solid var(--red-border);
      border-radius: var(--radius-sm);
    }
    .atmx-error-msg__icon {
      color: var(--red);
      flex-shrink: 0;
      line-height: 0;
    }
    .atmx-error-msg__text {
      font-size: 13px;
      color: var(--red);
      flex: 1;
    }
    .atmx-error-msg__retry {
      font-size: 12px;
      font-weight: 600;
      color: var(--accent);
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-xs);
      cursor: pointer;
      padding: 5px 12px;
      transition: all var(--transition);
      white-space: nowrap;
      font-family: var(--atmx-font);
    }
    .atmx-error-msg__retry:hover {
      background: var(--accent-bg);
      border-color: var(--accent);
    }

    /* \u2500\u2500 Contract ID \u2500\u2500 */
    .atmx-contract-id {
      font-size: 11px;
      color: var(--text-3);
      font-family: var(--atmx-mono);
      margin-top: 10px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* \u2500\u2500 Skeleton Loading \u2500\u2500 */
    .atmx-skel {
      background: linear-gradient(90deg, var(--surface) 25%, var(--border) 50%, var(--surface) 75%);
      background-size: 200% 100%;
      animation: atmx-shimmer 1.5s ease-in-out infinite;
      border-radius: 4px;
    }
    .atmx-skel--line { height: 13px; margin-bottom: 10px; }
    .atmx-skel--bar { height: 6px; margin-bottom: 10px; }
    .atmx-skel--pill { height: 20px; width: 80px; border-radius: 10px; }
    .atmx-skel--block { height: 48px; margin-top: 14px; border-radius: var(--radius-sm); }

    /* \u2500\u2500 Spinner \u2500\u2500 */
    .atmx-spinner {
      width: 14px;
      height: 14px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: atmx-spin 0.6s linear infinite;
      flex-shrink: 0;
    }

    /* \u2500\u2500 Animations \u2500\u2500 */
    @keyframes atmx-shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    @keyframes atmx-spin {
      to { transform: rotate(360deg); }
    }
    @keyframes atmx-in {
      from { opacity: 0; transform: translateY(-4px); }
      to { opacity: 1; transform: translateY(0); }
    }
  `;function u(t){return t<.1?"low":t<.3?"moderate":"high"}function _(t){return t==="low"?"\u2600\uFE0F":t==="moderate"?"\u{1F326}\uFE0F":"\u26C8\uFE0F"}function v(t){return t==="low"?"Low Risk":t==="moderate"?"Moderate Risk":"High Risk"}function s(t){return"$"+t.toFixed(2)}function b(t){return t.threshold_mm!=null?`${t.threshold_mm}mm rain`:t.threshold_ms!=null?`${t.threshold_ms} m/s wind`:t.threshold_c!=null?`${t.threshold_c}\xB0C`:t.threshold_cm!=null?`${t.threshold_cm}cm snow`:"threshold"}function f(t){return t.threshold_mm!=null?`\u2265 ${t.threshold_mm}mm`:t.threshold_ms!=null?`\u2265 ${t.threshold_ms} m/s`:t.threshold_c!=null?t.threshold_c<=0?`\u2264 ${t.threshold_c}\xB0C`:`\u2265 ${t.threshold_c}\xB0C`:t.threshold_cm!=null?`\u2265 ${t.threshold_cm}cm`:"\u2013"}function o(t){return new Promise(e=>setTimeout(e,t))}function k(t){let e=0;for(let r=0;r<t.length;r++)e=Math.imul(31,e)+t.charCodeAt(r)|0;return Math.abs(e)}function d(t){let e=Math.sin(t)*1e4;return e-Math.floor(e)}function l(){return{version:"v1.3",oracle_source:"NOAA_ASOS",threshold_mm:12.7,aggregation:"sum",min_stations:1,dispute_spread_ratio:.2}}function c(t){let e=k(t.h3Index),r=.1+d(e)*.35,a=.03+d(e+1)*.04,i=Math.round(r*t.payoutAmount*.125*100)/100;return{h3_index:t.h3Index,risk_type:t.riskType,risk_probability:Math.round(r*1e3)/1e3,confidence_interval:[Math.max(0,Math.round((r-a)*1e3)/1e3),Math.min(1,Math.round((r+a)*1e3)/1e3)],suggested_premium_usd:i,settlement_rule:l(),pricing_model:"ensemble_baseline_v1",valid_until:new Date(Date.now()+3e5).toISOString()}}function m(t,e){let r=crypto.randomUUID(),a=t.eventEnd.slice(0,10).replace(/-/g,"");return{contract_id:r,h3_index:t.h3Index,risk_type:t.riskType,start_time:t.eventStart,end_time:t.eventEnd,notional_usd:t.payoutAmount,premium_usd:e,settlement_rule:l(),status:"active",created_at:new Date().toISOString(),ticker:`ATMX-${t.h3Index.slice(0,11)}-PRECIP-13MM-${a}`}}async function w(t){if(!t.apiKey)return await o(500),c(t);try{let e=new URLSearchParams({h3_index:t.h3Index,risk_type:t.riskType,start_time:t.eventStart,end_time:t.eventEnd}),r=await fetch(`${t.apiUrl}/v1/risk_price?${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`}});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}catch{return console.warn("[ATMX] API unavailable \u2014 using demo pricing"),c(t)}}async function y(t,e){if(!t.apiKey)return await o(900),m(t,e);try{let r=await fetch(`${t.apiUrl}/v1/contracts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},body:JSON.stringify({h3_index:t.h3Index,risk_type:t.riskType,start_time:t.eventStart,end_time:t.eventEnd,notional_usd:t.payoutAmount})});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}catch{return console.warn("[ATMX] API unavailable \u2014 using demo contract"),m(t,e)}}function M(t){let e=t.dataset;return{h3Index:e.h3Index||"",eventStart:e.eventStart||"",eventEnd:e.eventEnd||"",payoutAmount:parseFloat(e.payoutAmount||"50"),apiKey:e.apiKey||"",apiUrl:(e.apiUrl||"").replace(/\/$/,""),theme:e.theme||"light",riskType:e.riskType||"precip_heavy"}}class T{constructor(e){this.state="loading";this.risk=null;this.contract=null;this.errMsg="";this.el=e,this.cfg=M(e),this.shadow=e.attachShadow({mode:"open"}),this.boot()}async boot(){if(this.render(),!this.cfg.h3Index){this.state="error",this.errMsg="Missing required data-h3-index attribute",this.render();return}if(!this.cfg.eventStart||!this.cfg.eventEnd){this.state="error",this.errMsg="Missing data-event-start or data-event-end",this.render();return}try{this.risk=await w(this.cfg),this.state="ready"}catch(e){this.state="error",this.errMsg=e?.message||"Failed to load weather data"}this.render(),this.animateBar(),this.emit("ready",{riskPrice:this.risk})}render(){let e=this.cfg.theme==="dark"?" atmx--dark":"",r=this.state==="active"?" atmx-card--active":"";this.shadow.innerHTML=`
        <style>${p}</style>
        <div class="atmx${e}">
          <div class="atmx-card${r}">
            ${this.headerHTML()}
            <div class="atmx-body">${this.bodyHTML()}</div>
            ${this.footerHTML()}
          </div>
        </div>`,this.bind()}headerHTML(){return`
        <div class="atmx-header">
          <div class="atmx-header__left">
            ${n.shield}
            <span class="atmx-header__title">Weather Protection</span>
          </div>
          <span class="atmx-header__brand">ATMX</span>
        </div>`}footerHTML(){return`
        <div class="atmx-footer">
          <span class="atmx-footer__text">
            Powered by <a class="atmx-footer__link" href="https://atmx.io" target="_blank" rel="noopener">ATMX</a>
          </span>
        </div>`}bodyHTML(){switch(this.state){case"loading":return this.loadingHTML();case"ready":return this.readyHTML();case"activating":return this.activatingHTML();case"active":return this.activeHTML();case"error":return this.errorHTML()}}loadingHTML(){return`
        <div class="atmx-skel atmx-skel--line" style="width:65%"></div>
        <div class="atmx-skel atmx-skel--bar"></div>
        <div class="atmx-skel atmx-skel--pill"></div>
        <div class="atmx-divider"></div>
        <div class="atmx-skel atmx-skel--line" style="width:100%"></div>
        <div class="atmx-skel atmx-skel--line" style="width:85%"></div>
        <div class="atmx-skel atmx-skel--line" style="width:60%"></div>
        <div class="atmx-skel atmx-skel--block"></div>`}riskSectionHTML(e=!0){let r=this.risk,a=u(r.risk_probability),i=Math.round(r.risk_probability*100);return`
        <div class="atmx-risk">
          <div class="atmx-risk__row">
            <span class="atmx-risk__emoji">${_(a)}</span>
            <span class="atmx-risk__text">
              <span class="atmx-risk__pct">${i}%</span> chance of heavy rain
            </span>
          </div>
          <div class="atmx-risk__bar">
            <div class="atmx-risk__fill atmx-risk__fill--${a}" data-pct="${i}"></div>
          </div>
          ${e?`<span class="atmx-risk__badge atmx-risk__badge--${a}">${v(a)}</span>`:""}
        </div>`}readyHTML(){let e=this.risk,r=e.suggested_premium_usd,a=this.cfg.payoutAmount;return`
        ${this.riskSectionHTML()}
        <div class="atmx-divider"></div>
        <div class="atmx-details">
          <div class="atmx-row">
            <span class="atmx-row__label">If rain exceeds</span>
            <span class="atmx-row__value">${b(e.settlement_rule)}</span>
          </div>
          <div class="atmx-row">
            <span class="atmx-row__label">You receive</span>
            <span class="atmx-row__value atmx-row__value--green">${s(a)}</span>
          </div>
          <div class="atmx-row">
            <span class="atmx-row__label">Verified by</span>
            <span class="atmx-row__value">${e.settlement_rule.oracle_source.replace(/_/g," ")}</span>
          </div>
        </div>
        <div class="atmx-toggle-area" data-action="toggle" tabindex="0" role="button"
             aria-label="Add weather protection for ${s(r)}">
          <div class="atmx-toggle-area__left">
            <span class="atmx-toggle-area__icon">\u{1F6E1}\uFE0F</span>
            <span class="atmx-toggle-area__text">Add Protection</span>
          </div>
          <span class="atmx-toggle-area__price">${s(r)}</span>
          <button class="atmx-switch" role="switch" aria-checked="false" tabindex="-1">
            <span class="atmx-switch__knob"></span>
          </button>
        </div>`}activatingHTML(){let e=this.risk;return`
        ${this.riskSectionHTML(!1)}
        <div class="atmx-divider"></div>
        <div class="atmx-toggle-area atmx-toggle-area--on">
          <div class="atmx-toggle-area__left">
            <div class="atmx-spinner"></div>
            <span class="atmx-toggle-area__text">Activating\u2026</span>
          </div>
          <span class="atmx-toggle-area__price">${s(e.suggested_premium_usd)}</span>
          <button class="atmx-switch atmx-switch--on" disabled>
            <span class="atmx-switch__knob"></span>
          </button>
        </div>`}activeHTML(){let e=this.risk,r=this.contract,a=this.cfg.payoutAmount;return`
        <div class="atmx-success">
          <span class="atmx-success__icon">${n.check}</span>
          <span class="atmx-success__text">Protection Active</span>
        </div>
        ${this.riskSectionHTML(!1)}
        <div class="atmx-divider"></div>
        <div class="atmx-details">
          <div class="atmx-row">
            <span class="atmx-row__label">Premium paid</span>
            <span class="atmx-row__value">${s(r.premium_usd)}</span>
          </div>
          <div class="atmx-row">
            <span class="atmx-row__label">Payout if triggered</span>
            <span class="atmx-row__value atmx-row__value--green">${s(a)}</span>
          </div>
          <div class="atmx-row">
            <span class="atmx-row__label">Trigger</span>
            <span class="atmx-row__value">${f(e.settlement_rule)} rain</span>
          </div>
          <div class="atmx-row">
            <span class="atmx-row__label">Settlement</span>
            <span class="atmx-row__value">${e.settlement_rule.oracle_source.replace(/_/g," ")} verified</span>
          </div>
        </div>
        <div class="atmx-toggle-area atmx-toggle-area--on" data-action="toggle" tabindex="0"
             role="button" aria-label="Remove weather protection">
          <div class="atmx-toggle-area__left">
            <span class="atmx-toggle-area__icon">\u2713</span>
            <span class="atmx-toggle-area__text">Protected</span>
          </div>
          <span class="atmx-toggle-area__price">${s(r.premium_usd)}</span>
          <button class="atmx-switch atmx-switch--on" role="switch" aria-checked="true" tabindex="-1">
            <span class="atmx-switch__knob"></span>
          </button>
        </div>
        <div class="atmx-contract-id">Contract: ${r.ticker}</div>`}errorHTML(){return`
        <div class="atmx-error-msg">
          <span class="atmx-error-msg__icon">${n.alert}</span>
          <span class="atmx-error-msg__text">${this.errMsg||"Unable to load weather data"}</span>
          <button class="atmx-error-msg__retry" data-action="retry">Retry</button>
        </div>`}bind(){let e=this.shadow.querySelector("[data-action=toggle]");e&&(e.addEventListener("click",()=>this.handleToggle()),e.addEventListener("keydown",a=>{let i=a.key;(i==="Enter"||i===" ")&&(a.preventDefault(),this.handleToggle())}));let r=this.shadow.querySelector("[data-action=retry]");r&&r.addEventListener("click",()=>{this.state="loading",this.errMsg="",this.boot()})}animateBar(){requestAnimationFrame(()=>{requestAnimationFrame(()=>{let e=this.shadow.querySelector(".atmx-risk__fill");e&&(e.style.width=e.dataset.pct+"%")})})}async handleToggle(){if(this.state==="ready"){this.state="activating",this.render(),this.animateBar();try{this.contract=await y(this.cfg,this.risk.suggested_premium_usd),this.state="active",this.render(),this.animateBar(),this.emit("activated",{contractId:this.contract.contract_id,ticker:this.contract.ticker,premium:this.contract.premium_usd,contract:this.contract})}catch(e){this.state="ready",this.render(),this.animateBar(),this.emit("error",{message:e?.message})}}else this.state==="active"&&(this.contract=null,this.state="ready",this.render(),this.animateBar(),this.emit("deactivated",{}))}emit(e,r){this.el.dispatchEvent(new CustomEvent(`atmx:${e}`,{detail:r,bubbles:!0,composed:!0}));let a=window.ATMX;if(a?._cbs[e])for(let i of a._cbs[e])i(r)}getContract(){return this.contract}getRisk(){return this.risk}getState(){return this.state}}class ${constructor(){this._widgets=new Map;this._cbs={}}mount(e){let r=e.id||`atmx-${this._widgets.size}`;e.id||(e.id=r);let a=new T(e);return this._widgets.set(r,a),a}get(e){return this._widgets.get(e)}on(e,r){var a;return((a=this._cbs)[e]||(a[e]=[])).push(r),this}off(e,r){return this._cbs[e]&&(this._cbs[e]=this._cbs[e].filter(a=>a!==r)),this}}let h=new $;window.ATMX=h;function x(){document.querySelectorAll(g).forEach(t=>{t.shadowRoot||h.mount(t)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x):x()})();})();
